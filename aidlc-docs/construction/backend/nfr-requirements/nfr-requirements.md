# NFR Requirements - Backend

## Overview
Backend 유닛의 비기능 요구사항(Non-Functional Requirements)을 정의합니다. 이 요구사항들은 시스템의 품질 속성을 보장하며, 기술 스택 선택과 아키텍처 설계의 기준이 됩니다.

---

## NFR-1: 성능 요구사항 (Performance Requirements)

### NFR-1.1: API 응답 시간
**요구사항**: REST API의 평균 응답 시간은 1초 이내여야 함

**측정 기준**:
- 95 percentile: 1초 이내
- 99 percentile: 2초 이내
- 최대 응답 시간: 3초

**적용 범위**:
- 모든 GET 요청 (조회)
- POST, PUT, DELETE 요청 (생성, 수정, 삭제)

**검증 방법**:
- 성능 테스트 도구 (JMeter, Gatling)
- Spring Boot Actuator metrics

**예외**:
- 파일 업로드: 파일 크기에 따라 가변 (최대 5MB, 약 5초)
- 대량 데이터 조회: 페이지네이션 적용

---

### NFR-1.2: SSE 이벤트 전송 지연
**요구사항**: SSE 이벤트는 발생 후 2초 이내에 클라이언트에 전달되어야 함

**측정 기준**:
- 이벤트 발생 시각 ~ 클라이언트 수신 시각 < 2초

**적용 범위**:
- NEW_ORDER 이벤트
- ORDER_STATUS_CHANGED 이벤트
- ORDER_DELETED 이벤트

**검증 방법**:
- 타임스탬프 비교 (서버 발생 시각 vs 클라이언트 수신 시각)
- 로그 분석

---

### NFR-1.3: 데이터베이스 쿼리 성능
**요구사항**: 단일 쿼리 실행 시간은 100ms 이내여야 함

**측정 기준**:
- 평균 쿼리 시간: 50ms 이내
- 최대 쿼리 시간: 100ms 이내

**최적화 전략**:
- 적절한 인덱스 설계
- N+1 쿼리 방지 (JOIN 사용)
- 쿼리 결과 캐싱 (메뉴, 매장 정보)

**검증 방법**:
- MyBatis 쿼리 로깅
- 데이터베이스 프로파일링

---

### NFR-1.4: 페이지 로딩 시간
**요구사항**: 프론트엔드 페이지 로딩 시간은 3초 이내여야 함 (기존 NFR-1)

**측정 기준**:
- 초기 페이지 로드: 3초 이내
- 후속 페이지 로드: 1초 이내 (캐싱 활용)

**Backend 기여**:
- API 응답 시간 최적화
- 정적 파일 캐싱 헤더 설정

---

## NFR-2: 확장성 요구사항 (Scalability Requirements)

### NFR-2.1: 동시 사용자 수
**요구사항**: 동시 접속 50명 이하를 지원해야 함

**시나리오**:
- 5개 매장, 각 10개 테이블
- 테이블당 평균 1명의 고객 (태블릿 사용)
- 매장당 1~2명의 관리자

**리소스 계획**:
- 데이터베이스 연결 풀: 10개
- SSE 동시 연결: 최대 60개 (50명 고객 + 10명 관리자)
- 메모리: 최소 512MB, 권장 1GB

**검증 방법**:
- 부하 테스트 (50명 동시 접속)
- 리소스 모니터링 (CPU, 메모리, 연결 수)

---

### NFR-2.2: 데이터 증가율
**요구사항**: 일일 주문 500건까지 처리 가능해야 함

**예상 데이터 증가**:
- 주문: 500건/일 → 15,000건/월 → 180,000건/년
- 주문 항목: 평균 3개/주문 → 1,500건/일
- 메뉴 이미지: 평균 10개/매장 → 50개 (5개 매장)

**저장소 요구사항**:
- 데이터베이스: In-Memory (영속성 불필요)
- 파일 저장소: 약 250MB (50개 이미지 × 5MB)

**확장 계획**:
- 매장 추가 시 선형 확장 (수평 확장 불필요)

---

### NFR-2.3: 매장 확장성
**요구사항**: 최대 10개 매장까지 확장 가능해야 함

**확장 시나리오**:
- 현재: 5개 매장
- 향후: 10개 매장 (2배 확장)

**확장 전략**:
- 단일 서버로 처리 (수평 확장 불필요)
- 데이터 격리: 계층적 격리 (Store → Table → Order)

---

## NFR-3: 가용성 요구사항 (Availability Requirements)

### NFR-3.1: 시스템 가용성
**요구사항**: 개발/테스트 환경으로 고가용성 불필요

**목표 가용성**: 95% (월 36시간 다운타임 허용)

**다운타임 허용 시나리오**:
- 계획된 유지보수
- 배포 및 업데이트
- 개발 환경 재시작

**가용성 향상 전략** (향후 프로덕션 환경):
- 로드 밸런서
- 다중 인스턴스
- 헬스 체크

---

### NFR-3.2: 장애 복구 시간
**요구사항**: 장애 발생 시 30분 이내 복구

**복구 절차**:
1. 장애 감지 (수동 또는 알림)
2. 로그 분석 및 원인 파악
3. 애플리케이션 재시작 또는 롤백
4. 서비스 정상화 확인

**복구 도구**:
- 로그 파일 분석
- 애플리케이션 재시작 스크립트

---

### NFR-3.3: 데이터 백업 및 복구
**요구사항**: 필요 시 수동 백업 수행

**백업 전략**:
- In-Memory DB 사용으로 자동 백업 불필요
- 필요 시 데이터 내보내기 (CSV, JSON)
- 중요 데이터는 OrderHistory로 이동 (세션 종료 시)

**복구 전략**:
- 데이터 손실 시 재입력
- OrderHistory는 최대 1년 보관

---

## NFR-4: 보안 요구사항 (Security Requirements)

### NFR-4.1: 인증 및 권한
**요구사항**: JWT 기반 인증 및 역할 기반 권한 관리 (기존 NFR-2)

**인증 방식**:
- 관리자: JWT 토큰 (16시간 만료)
- 고객: 테이블 세션 ID (UUID, 16시간 유효)

**권한 관리**:
- ADMIN: 모든 관리 기능 접근
- MANAGER: 제한된 관리 기능 (향후 확장)
- CUSTOMER: 주문 생성 및 조회만

**검증 방법**:
- JWT 서명 검증
- 세션 ID 유효성 확인

---

### NFR-4.2: 비밀번호 보안
**요구사항**: 비밀번호는 bcrypt로 해싱하여 저장 (기존 NFR-2)

**해싱 알고리즘**:
- bcrypt (strength: 10)
- 60자 해시값 저장

**PIN 보안**:
- 테이블 PIN: SHA-256 해싱
- 64자 해시값 저장

---

### NFR-4.3: 로그인 보안
**요구사항**: 로그인 5회 실패 시 계정 잠금 (기존 NFR-2)

**잠금 정책**:
- 5회 연속 실패 시 30분 잠금
- 잠금 해제 후 시도 횟수 초기화

**보안 로깅**:
- 로그인 시도 기록
- 계정 잠금 이벤트 로깅

---

### NFR-4.4: 보안 헤더
**요구사항**: CORS 설정으로 최소 보안 보장

**CORS 설정**:
- 허용 Origin: 프론트엔드 도메인만
- 허용 Method: GET, POST, PUT, DELETE
- 허용 Header: Authorization, Content-Type

**추가 보안 헤더** (향후 프로덕션):
- HSTS (HTTP Strict Transport Security)
- CSP (Content Security Policy)
- X-Frame-Options

---

### NFR-4.5: 데이터 보호
**요구사항**: 민감한 데이터는 암호화하여 저장

**암호화 대상**:
- 비밀번호: bcrypt 해싱
- PIN: SHA-256 해싱

**암호화 제외**:
- 주문 데이터: 평문 저장 (비즈니스 데이터)
- 메뉴 데이터: 평문 저장

---

## NFR-5: 신뢰성 요구사항 (Reliability Requirements)

### NFR-5.1: 에러 처리
**요구사항**: 모든 에러는 적절히 처리되고 사용자에게 명확한 메시지 제공 (기존 NFR-4)

**에러 처리 전략**:
- 비즈니스 예외: 명확한 에러 메시지
- 시스템 예외: 일반적인 에러 메시지 (보안상 상세 정보 숨김)
- 검증 실패: 필드별 에러 메시지

**에러 응답 형식**:
```json
{
  "timestamp": "2026-02-09T14:30:00Z",
  "status": 400,
  "error": "Bad Request",
  "message": "필수 필드가 누락되었습니다: storeId",
  "path": "/api/customer/orders"
}
```

---

### NFR-5.2: 재시도 전략
**요구사항**: 외부 시스템 호출 실패 시 3회 재시도

**재시도 대상**:
- 파일 저장 실패
- SSE 이벤트 전송 실패

**재시도 정책**:
- 최대 3회 재시도
- 고정 간격: 1초
- 3회 실패 시 에러 반환

**재시도 제외**:
- 데이터베이스 쿼리 (트랜잭션 롤백)
- 비즈니스 검증 실패

---

### NFR-5.3: SSE 재연결
**요구사항**: SSE 연결 실패 시 클라이언트가 3회 재연결 시도 (기존 NFR-4)

**재연결 정책**:
- 최대 3회 재시도
- 재시도 간격: 3초
- 3회 실패 시 "실시간 업데이트 불가" 메시지 표시

**서버 측 처리**:
- 타임아웃: 30초
- 타임아웃 시 연결 자동 해제
- 클라이언트 재연결 허용

---

### NFR-5.4: 트랜잭션 관리
**요구사항**: 데이터 무결성을 위한 트랜잭션 관리

**트랜잭션 격리 수준**:
- READ_COMMITTED (기본값)

**트랜잭션 경계**:
- Service 레이어 메서드 단위
- 읽기 전용 트랜잭션: @Transactional(readOnly = true)

**롤백 정책**:
- RuntimeException 발생 시 자동 롤백
- Checked Exception은 롤백 안 함 (명시적 설정 필요)

---

## NFR-6: 유지보수성 요구사항 (Maintainability Requirements)

### NFR-6.1: 로깅
**요구사항**: 표준 로깅으로 디버깅 및 모니터링 지원

**로깅 레벨**:
- INFO: 주요 비즈니스 이벤트 (주문 생성, 상태 변경)
- WARN: 경고 (재시도, 데이터 불일치)
- ERROR: 에러 (예외 발생, 시스템 오류)

**로깅 대상**:
- 모든 API 요청/응답 (INFO)
- 비즈니스 로직 실행 (INFO)
- 에러 및 예외 (ERROR)
- 성능 이슈 (WARN)

**로그 형식**:
- 텍스트 형식 (Logback 기본)
- 타임스탬프, 로그 레벨, 클래스명, 메시지 포함

---

### NFR-6.2: 모니터링
**요구사항**: 개발 환경으로 모니터링 불필요

**향후 프로덕션 환경**:
- Spring Boot Actuator (health, metrics)
- Prometheus + Grafana (선택적)

**모니터링 항목** (향후):
- 시스템 헬스 (CPU, 메모리, 디스크)
- API 응답 시간
- 데이터베이스 연결 풀 상태
- SSE 연결 수

---

### NFR-6.3: API 문서화
**요구사항**: Swagger/OpenAPI로 API 문서 자동 생성 (기존 요구사항)

**문서화 도구**:
- Springdoc OpenAPI (Swagger UI)

**문서 내용**:
- 모든 REST API 엔드포인트
- 요청/응답 스키마
- 에러 응답 예시
- 인증 방법

**접근 경로**:
- Swagger UI: `/swagger-ui.html`
- OpenAPI JSON: `/v3/api-docs`

---

### NFR-6.4: 코드 품질
**요구사항**: 유지보수 가능한 코드 작성

**코드 품질 기준**:
- 명확한 네이밍 (변수, 메서드, 클래스)
- 적절한 주석 (복잡한 로직만)
- 단일 책임 원칙 (SRP)
- DRY 원칙 (Don't Repeat Yourself)

**테스트 커버리지** (향후):
- Unit 테스트: 70% 이상
- Integration 테스트: 주요 워크플로우

---

## NFR-7: 사용성 요구사항 (Usability Requirements)

### NFR-7.1: 터치 친화적 UI
**요구사항**: 모든 버튼은 최소 44x44px 크기 (기존 NFR-3)

**Backend 기여**:
- API 응답에 UI 힌트 포함 (선택적)
- 에러 메시지는 사용자 친화적

---

### NFR-7.2: 에러 메시지
**요구사항**: 사용자에게 명확하고 이해하기 쉬운 에러 메시지 제공

**메시지 원칙**:
- 한국어로 작성
- 구체적인 문제 설명
- 해결 방법 제시 (가능한 경우)

**예시**:
- "필수 필드가 누락되었습니다: storeId"
- "유효하지 않은 테이블 세션입니다"
- "메뉴를 찾을 수 없거나 비활성 상태입니다"

---

## NFR Summary Table

| 카테고리 | 요구사항 | 목표 | 우선순위 |
|----------|----------|------|----------|
| 성능 | API 응답 시간 | 1초 이내 | High |
| 성능 | SSE 이벤트 전송 | 2초 이내 | High |
| 성능 | DB 쿼리 시간 | 100ms 이내 | Medium |
| 확장성 | 동시 사용자 | 50명 | High |
| 확장성 | 매장 수 | 최대 10개 | Medium |
| 가용성 | 시스템 가용성 | 95% | Low |
| 가용성 | 복구 시간 | 30분 이내 | Medium |
| 보안 | JWT 인증 | 16시간 만료 | High |
| 보안 | 비밀번호 해싱 | bcrypt | High |
| 보안 | 로그인 잠금 | 5회 실패 | High |
| 신뢰성 | 에러 처리 | 명확한 메시지 | High |
| 신뢰성 | 재시도 | 3회 | Medium |
| 유지보수성 | 로깅 | INFO, WARN, ERROR | High |
| 유지보수성 | API 문서 | Swagger/OpenAPI | High |

---

## Notes

- 이 NFR은 개발/테스트 환경을 기준으로 정의됨
- 프로덕션 환경으로 전환 시 NFR 재검토 필요
- 특히 가용성, 모니터링, 백업 전략은 프로덕션에서 강화 필요
- 성능 및 확장성 요구사항은 실제 부하 테스트로 검증 필요

