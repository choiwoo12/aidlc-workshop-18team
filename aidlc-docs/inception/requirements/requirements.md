# 테이블오더 서비스 요구사항 명세서

## Intent Analysis

### User Request
테이블오더 서비스를 구축하고 싶습니다. 요구사항 문서(table-order-requirements.md, constraints.md)를 기반으로 한 신규 프로젝트입니다.

### Request Type
**New Project** - 완전한 신규 프로젝트 (Greenfield)

### Scope Estimate
**System-wide** - 고객용 인터페이스, 관리자용 인터페이스, 백엔드 API, 데이터베이스를 포함한 전체 시스템 구축

### Complexity Estimate
**Complex** - 실시간 통신, 세션 관리, 다중 사용자 인터페이스, 데이터 동기화 등 다양한 기술적 고려사항 포함

---

## 1. 프로젝트 개요

### 1.1 서비스 비전
디지털 주문 시스템을 통해 고객에게는 편리한 주문 경험을, 매장 운영자에게는 효율적인 운영 환경을 제공하는 차세대 테이블오더 플랫폼

### 1.2 핵심 가치 제안

**고객 관점**
- 대기 시간 없는 즉시 주문
- 직관적이고 사용하기 쉬운 인터페이스

**매장 운영자 관점**
- 인건비 절감 및 운영 효율성 증대
- 실시간 주문 관리 및 모니터링

**시장 차별화**
- 다양한 업종에 적용 가능한 유연한 구조
- 직관적인 관리자 도구

### 1.3 시스템 구성 요소
- **고객용 웹 인터페이스**: 테이블 태블릿에서 동작하는 주문 화면
- **관리자용 웹 인터페이스**: 매장 운영자용 관리 대시보드
- **백엔드 API 서버**: Python 기반 REST API
- **데이터베이스**: 인메모리 데이터베이스 (개발용)
- **실시간 통신**: Server-Sent Events (SSE)

---

## 2. 기능 요구사항 (Functional Requirements)


### 2.1 고객용 기능 (Customer Features)

#### FR-C1: 테이블 태블릿 자동 로그인 및 세션 관리
- **초기 설정** (관리자가 1회 수행):
  - 매장 식별자 입력 (사람이 읽을 수 있는 코드 형식: store-001, cafe-gangnam 등)
  - 테이블 번호 입력 (숫자만: 1, 2, 3...)
  - 테이블 비밀번호 입력
  - 로그인 정보를 SessionStorage에 저장
- **자동 로그인**:
  - 저장된 정보로 자동 로그인
  - 16시간 세션 유지

#### FR-C2: 메뉴 조회 및 탐색
- 메뉴 화면이 기본 화면으로 표시
- 카테고리별 메뉴 분류 및 표시
- 메뉴 상세 정보 표시:
  - 메뉴명
  - 가격
  - 메뉴 설명
  - 메뉴 이미지 (서버 업로드 방식)
- 카테고리 간 빠른 이동
- 카드 형태의 메뉴 레이아웃
- 터치 친화적인 버튼 크기 (최소 44x44px)

#### FR-C3: 장바구니 관리
- 메뉴 추가/삭제
- 수량 조절 (증가/감소)
- 총 금액 실시간 계산
- 장바구니 비우기
- SessionStorage에 저장 (페이지 새로고침 시에도 유지)

#### FR-C4: 주문 생성
- 주문 내역 최종 확인
- 주문 확정 버튼
- **주문 성공 플로우**:
  - 주문 번호 표시 (5초간)
  - 장바구니 자동 비우기
  - 메뉴 화면으로 자동 리다이렉트
- 주문 실패 시 에러 메시지 표시 및 장바구니 유지
- **주문 정보 포함 항목**:
  - 매장 식별 정보
  - 테이블 식별 정보
  - 주문 메뉴 목록 (메뉴명, 수량, 단가)
  - 총 주문 금액
  - 세션 ID (테이블 세션 추적용)

#### FR-C5: 주문 내역 조회
- 현재 테이블 세션의 주문만 표시
- 주문 시간 순 정렬
- 주문별 상세 정보:
  - 주문 번호
  - 주문 시각
  - 주문 메뉴 및 수량
  - 주문 금액
  - 주문 상태 (대기중/준비중/완료)
- 페이지네이션 또는 무한 스크롤


### 2.2 관리자용 기능 (Admin Features)

#### FR-A1: 매장 인증
- 매장 식별자 입력 (사람이 읽을 수 있는 코드 형식)
- 사용자명 및 비밀번호 입력
- **세션 관리**:
  - 16시간 세션 유지
  - JWT 토큰 기반 인증 (LocalStorage 저장)
  - 브라우저 새로고침 시 세션 유지
  - 16시간 후 자동 로그아웃
- **보안**:
  - bcrypt 해싱으로 비밀번호 저장
  - 로그인 시도 제한

#### FR-A2: 실시간 주문 모니터링
- **주문 목록 실시간 업데이트** (Server-Sent Events 사용)
- **그리드/대시보드 레이아웃**:
  - 테이블별 카드 형태 표시
  - 각 테이블 카드에 총 주문액 표시
  - 최신 주문 n개 미리보기
- 주문별 상세 정보:
  - 테이블 번호
  - 주문 번호
  - 주문 시각
  - 주문 메뉴 및 수량 (축약)
  - 총 금액
- **주문 카드 클릭 시**: 전체 메뉴 목록 상세 보기
- 주문 상태 변경 (관리자만 가능: 대기중/준비중/완료)
- 신규 주문 시각적 강조 (색상 변경, 애니메이션)
- 2초 이내 주문 표시

#### FR-A3: 테이블 관리
**1. 테이블 태블릿 초기 설정**:
- 테이블 번호 및 테이블 비밀번호 설정
- 16시간 세션 생성
- 설정 정보 저장 및 자동 로그인 활성화

**2. 주문 삭제 (직권 수정)**:
- 특정 주문 삭제 버튼
- 확인 팝업 표시
- 주문 즉시 삭제
- 테이블 총 주문액 재계산
- 성공/실패 피드백

**3. 테이블 세션 처리**:
- 테이블 세션 시작 및 종료 관리
- 확인 팝업 표시
- 테이블 세션 종료(이용 완료) 시:
  - 해당 세션의 주문 내역을 과거 이력으로 이동
  - 테이블 현재 주문 목록 및 총 주문액 0으로 리셋
- 새 고객이 이전 주문 내역 없이 시작 가능

**4. 과거 주문 내역 조회**:
- "과거 내역" 버튼
- 테이블별 과거 주문 목록 표시 (시간 역순)
- 각 주문 정보: 주문 번호, 시각, 메뉴 목록, 총 금액, 매장 이용 완료 시각
- 날짜 필터링 기능
- 보관 기간: 1년 후 삭제
- "닫기" 버튼으로 대시보드 복귀

#### FR-A4: 메뉴 관리
- 메뉴 조회 (카테고리별)
- 메뉴 등록:
  - 메뉴명
  - 가격
  - 설명
  - 카테고리
  - 이미지 업로드 (서버 저장)
- 메뉴 수정
- 메뉴 삭제
- 메뉴 노출 순서 조정
- 필수 필드 검증
- 가격 범위 검증


---

## 3. 비기능 요구사항 (Non-Functional Requirements)

### 3.1 성능 요구사항 (Performance)
- **NFR-P1**: 주문 생성 응답 시간 < 2초
- **NFR-P2**: 메뉴 조회 응답 시간 < 1초
- **NFR-P3**: 실시간 주문 업데이트 지연 < 2초
- **NFR-P4**: 동시 접속 지원: 소규모 (10개 테이블 미만)

### 3.2 보안 요구사항 (Security)
- **NFR-S1**: 비밀번호 bcrypt 해싱 저장
- **NFR-S2**: JWT 토큰 기반 인증
- **NFR-S3**: 로그인 시도 제한
- **NFR-S4**: HTTPS 통신 (프로덕션 환경)
- **NFR-S5**: 민감 정보는 환경 변수로 관리

### 3.3 사용성 요구사항 (Usability)
- **NFR-U1**: 터치 친화적 UI (최소 버튼 크기 44x44px)
- **NFR-U2**: 직관적인 네비게이션
- **NFR-U3**: 명확한 시각적 피드백 (로딩, 성공, 에러)
- **NFR-U4**: 반응형 디자인 (태블릿 최적화)

### 3.4 신뢰성 요구사항 (Reliability)
- **NFR-R1**: 에러 처리 및 사용자 친화적 에러 메시지
- **NFR-R2**: 파일 기반 로깅
- **NFR-R3**: 장바구니 데이터 영속성 (SessionStorage)
- **NFR-R4**: 세션 타임아웃 처리 (16시간)

### 3.5 유지보수성 요구사항 (Maintainability)
- **NFR-M1**: 코드 린팅 (언어별 표준 린터)
- **NFR-M2**: API 문서화 (Swagger/OpenAPI)
- **NFR-M3**: 명확한 코드 주석 및 문서화
- **NFR-M4**: 모듈화된 코드 구조

### 3.6 테스트 요구사항 (Testability)
- **NFR-T1**: 단위 테스트 (핵심 로직)
- **NFR-T2**: 통합 테스트 (API 엔드포인트)
- **NFR-T3**: E2E 테스트 (주요 사용자 플로우)

---

## 4. 기술 스택 (Technology Stack)

### 4.1 백엔드
- **언어/프레임워크**: Python (FastAPI, Django, Flask 중 선택)
- **데이터베이스**: 인메모리 데이터베이스 (SQLite, Redis 등)
- **인증**: JWT (JSON Web Token)
- **비밀번호 해싱**: bcrypt
- **실시간 통신**: Server-Sent Events (SSE)

### 4.2 프론트엔드
- **프레임워크**: React
- **상태 관리**: Context API 또는 Redux (필요 시)
- **스타일링**: CSS Modules, Styled Components, 또는 Tailwind CSS
- **HTTP 클라이언트**: Axios 또는 Fetch API
- **로컬 저장소**: SessionStorage (테이블 태블릿), LocalStorage (관리자 JWT)

### 4.3 개발 환경
- **컨테이너화**: Docker Compose
- **버전 관리**: Git (GitHub Flow 전략)
- **API 문서화**: Swagger/OpenAPI
- **린팅**: 언어별 표준 린터 (ESLint for JavaScript, Pylint/Black for Python)

### 4.4 배포
- **환경**: 로컬 개발 환경만 (배포 계획 없음)
- **로깅**: 파일 기반 로깅

---

## 5. 데이터 모델 (Data Model)

### 5.1 주요 엔티티

#### Store (매장)
- store_id (PK): 사람이 읽을 수 있는 코드 (예: store-001)
- store_name: 매장명
- admin_username: 관리자 사용자명
- admin_password_hash: 관리자 비밀번호 해시 (bcrypt)
- created_at: 생성 시각

#### Table (테이블)
- table_id (PK): 자동 생성 ID
- store_id (FK): 매장 ID
- table_number: 테이블 번호 (숫자)
- table_password_hash: 테이블 비밀번호 해시
- session_id: 현재 세션 ID
- session_start_time: 세션 시작 시각
- created_at: 생성 시각

#### Menu (메뉴)
- menu_id (PK): 자동 생성 ID
- store_id (FK): 매장 ID
- menu_name: 메뉴명
- price: 가격
- description: 설명
- category: 카테고리
- image_path: 이미지 경로 (서버 저장)
- display_order: 노출 순서
- created_at: 생성 시각
- updated_at: 수정 시각

#### Order (주문)
- order_id (PK): 자동 생성 ID
- store_id (FK): 매장 ID
- table_id (FK): 테이블 ID
- session_id: 세션 ID
- order_number: 주문 번호 (표시용)
- total_amount: 총 주문 금액
- status: 주문 상태 (대기중/준비중/완료)
- created_at: 주문 시각
- updated_at: 수정 시각

#### OrderItem (주문 항목)
- order_item_id (PK): 자동 생성 ID
- order_id (FK): 주문 ID
- menu_id (FK): 메뉴 ID
- menu_name: 메뉴명 (스냅샷)
- quantity: 수량
- unit_price: 단가 (스냅샷)
- subtotal: 소계

#### OrderHistory (주문 이력)
- history_id (PK): 자동 생성 ID
- store_id (FK): 매장 ID
- table_id (FK): 테이블 ID
- session_id: 세션 ID
- order_data: 주문 전체 데이터 (JSON)
- completed_at: 매장 이용 완료 시각
- retention_until: 보관 만료일 (1년 후)


---

## 6. 시스템 제약사항 (System Constraints)

### 6.1 제외 기능 (Out of Scope)

#### 결제 관련
- 실제 결제 처리 (카드, 현금, 디지털 지갑)
- 결제 게이트웨이 연동 (PG사 연동)
- 영수증 발행 및 출력
- 환불 처리
- 포인트/쿠폰 시스템

#### 인증 및 보안
- 복잡한 사용자 인증 (OAuth, SNS 로그인)
- 다단계 인증 (2FA, OTP)

#### 파일 및 컨텐츠 관리
- 이미지 리사이징/최적화
- 컨텐츠 관리 시스템
- 광고 기능

#### 알림 시스템
- 푸시 알림 (모바일, 브라우저)
- SMS 알림
- 이메일 발송
- 소리/진동 알림

#### 주방 기능
- 주문 내역 주방 전달
- 주방 식재료 재고 관리

#### 고급 기능
- 데이터 분석 및 대시보드
- 매출 리포트 생성
- 재고 관리 시스템
- 직원 관리 및 권한 설정
- 예약 시스템
- 고객 리뷰 시스템
- 다국어 기능

#### 외부 연동
- 배달 플랫폼 연동
- POS 시스템 연동
- 소셜 미디어 공유
- 지도 API
- 번역 API

### 6.2 기술적 제약사항
- 로컬 개발 환경만 지원 (클라우드 배포 없음)
- 인메모리 데이터베이스 사용 (프로덕션 DB 없음)
- 소규모 동시 접속 지원 (10개 테이블 미만)

---

## 7. 사용자 시나리오 (User Scenarios)

### 7.1 고객 시나리오

#### 시나리오 1: 첫 방문 고객의 주문
1. 고객이 테이블에 앉음
2. 태블릿이 자동으로 로그인됨 (관리자가 사전 설정)
3. 메뉴 화면이 표시됨
4. 고객이 카테고리를 탐색하며 메뉴 선택
5. 장바구니에 메뉴 추가
6. 수량 조절
7. 주문 확정
8. 주문 번호 확인 (5초간 표시)
9. 메뉴 화면으로 자동 복귀

#### 시나리오 2: 추가 주문
1. 고객이 메뉴 화면에서 추가 메뉴 선택
2. 장바구니에 추가
3. 주문 확정
4. 주문 내역 조회로 이전 주문과 새 주문 확인

#### 시나리오 3: 주문 내역 확인
1. 고객이 "주문 내역" 버튼 클릭
2. 현재 세션의 모든 주문 확인
3. 각 주문의 상태 확인 (대기중/준비중/완료)

### 7.2 관리자 시나리오

#### 시나리오 1: 매장 오픈 준비
1. 관리자가 로그인
2. 각 테이블 태블릿 초기 설정 (테이블 번호, 비밀번호)
3. 메뉴 등록 및 이미지 업로드
4. 메뉴 카테고리 및 순서 조정

#### 시나리오 2: 실시간 주문 관리
1. 관리자가 대시보드 확인
2. 새 주문이 실시간으로 표시됨 (SSE)
3. 주문 카드 클릭하여 상세 내역 확인
4. 주문 상태를 "준비중"으로 변경
5. 음식 준비 완료 후 "완료"로 변경

#### 시나리오 3: 주문 수정 및 삭제
1. 고객이 주문 취소 요청
2. 관리자가 해당 주문 찾기
3. 주문 삭제 버튼 클릭
4. 확인 팝업에서 확인
5. 주문 삭제 및 총 주문액 재계산

#### 시나리오 4: 테이블 이용 완료 처리
1. 고객이 식사 완료 및 계산
2. 관리자가 "이용 완료" 버튼 클릭
3. 확인 팝업에서 확인
4. 해당 테이블의 주문 내역이 과거 이력으로 이동
5. 테이블 현재 주문 목록 및 총 주문액 0으로 리셋
6. 새 고객이 해당 테이블 사용 가능

#### 시나리오 5: 과거 주문 내역 조회
1. 관리자가 "과거 내역" 버튼 클릭
2. 특정 테이블 선택
3. 날짜 필터 적용
4. 과거 주문 목록 확인
5. 각 주문의 상세 정보 확인

---

## 8. MVP 개발 범위

### 8.1 핵심 기능 (필수)

**고객용**:
- ✅ 테이블 태블릿 자동 로그인 및 세션 관리
- ✅ 메뉴 조회
- ✅ 장바구니 관리
- ✅ 주문 생성 (5초 표시 후 자동 리다이렉트)
- ✅ 주문 내역 조회 (현재 세션만)

**관리자용**:
- ✅ 매장 인증 (16시간 세션)
- ✅ 실시간 주문 모니터링 (그리드 레이아웃, SSE)
- ✅ 테이블 관리 (초기 설정, 주문 삭제, 매장 이용 완료, 과거 내역 조회)
- ✅ 메뉴 관리 (CRUD)

---

## 9. 용어 정의 (Glossary)

- **MVP**: Minimum Viable Product (최소 기능 제품)
- **API**: Application Programming Interface
- **UI/UX**: User Interface / User Experience
- **SSE**: Server-Sent Events (서버에서 클라이언트로 실시간 데이터 전송)
- **JWT**: JSON Web Token (인증 토큰)
- **bcrypt**: 비밀번호 해싱 알고리즘
- **테이블 세션**: 특정 테이블에 고객이 앉아서 첫 주문 시작 후부터 해당 테이블 이용 완료 처리까지의 시간. 세션 종료 후 다른 고객의 첫 주문 시작 시, 새로운 세션 시작.
- **SessionStorage**: 브라우저 탭/창이 열려있는 동안만 데이터 유지
- **LocalStorage**: 브라우저를 닫아도 데이터 유지

---

## 10. 요구사항 요약

### 10.1 핵심 요구사항
1. **실시간 주문 시스템**: SSE를 통한 실시간 주문 업데이트
2. **세션 관리**: 테이블별 세션 추적 및 관리
3. **직관적 UI**: 터치 친화적이고 사용하기 쉬운 인터페이스
4. **효율적 관리**: 관리자용 대시보드로 모든 주문 실시간 모니터링
5. **데이터 영속성**: 장바구니 및 세션 정보 로컬 저장

### 10.2 기술적 우선순위
1. Python 백엔드 (FastAPI/Django/Flask)
2. React 프론트엔드
3. 인메모리 데이터베이스
4. Server-Sent Events (SSE)
5. JWT 인증
6. Docker Compose 개발 환경

### 10.3 품질 목표
- 포괄적 테스트 커버리지 (단위 + 통합 + E2E)
- API 문서화 (Swagger/OpenAPI)
- 코드 품질 관리 (린팅)
- 파일 기반 로깅

---

**문서 버전**: 1.0  
**작성일**: 2026-02-09  
**상태**: 승인 대기
